<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>H1B News Lab ‚Äî Prototype (Simulated)</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <header class="topbar">
    <div class="brand">
      <div class="logo">H1B</div>
      <div class="titles">
        <h1>H1B News Lab</h1>
        <p class="subtitle">How changing headlines shift feelings, understanding, and actions <span class="sim">(SIMULATED CONTENT)</span></p>
      </div>
    </div>
    <div class="controls">
      <div class="control">
        <label>Frame tone</label>
        <select id="frameTone">
          <option value="auto">auto</option>
          <option value="neutral">neutral</option>
          <option value="alarming">alarming</option>
        </select>
      </div>
      <div class="control">
        <label>Source label</label>
        <select id="sourceLabel">
          <option value="auto">auto</option>
          <option value="official">official</option>
          <option value="major">major</option>
          <option value="social">social</option>
        </select>
      </div>
      <div class="control">
        <label>Uncertainty badge</label>
        <select id="uncertaintyFlag">
          <option value="auto">auto</option>
          <option value="on">on</option>
          <option value="off">off</option>
        </select>
      </div>
      <div class="control">
        <label>Delivery cadence</label>
        <select id="cadenceMode">
          <option value="auto">auto</option>
          <option value="rapid">rapid stream</option>
          <option value="batched">batched digest</option>
        </select>
      </div>
    </div>
  </header>

  <main class="layout">
    <section class="feed" id="feed">
      <div class="consent" id="consent">
        <h2>Consent (Prototype)</h2>
        <p>
          This is a class research prototype about news UX. You will see <b>simulated</b> H-1B related updates.
          We log interaction data (time, reading behavior, slider ratings) and store it locally in your browser for this demo.
        </p>

        <div class="form-grid">
          <div class="field">
            <label for="nameField">Name</label>
            <input id="nameField" type="text" placeholder="e.g., Komalika" />
          </div>
          <div class="field">
            <label for="roleField">I am a‚Ä¶</label>
            <select id="roleField">
              <option value="">Select one</option>
              <option value="f1">F-1 student</option>
              <option value="h1b">H-1B employee</option>
              <option value="dependent">Dependent / family</option>
            </select>
          </div>
        </div>

        <label class="agree-row"><input type="checkbox" id="agreeBox" /> I understand and agree to continue.</label>

        <div class="consent-actions">
          <label class="agree-row"><input type="checkbox" id="webcamOptIn" /> Use webcam to estimate <b>neutral vs confused</b> (optional). Processed locally; no video stored.</label>

          <button id="startBtn" class="primary">Start Iteration 1</button>
          <div class="muted-note">You will complete <b>5 iterations</b>. The facilitator may change the four parameters between iterations.</div>
        </div>
      </div>

      <div id="cards"></div>
    </section>

    <aside class="panel">
      <div class="badge-grid">
        <div class="badge kpi"><span id="kpiIter">0/5</span><label>iteration</label></div>
        <div class="badge kpi"><span id="kpiCards">0</span><label>updates read</label></div>
        <div class="badge kpi"><span id="kpiAffect">‚Äì</span><label>last worry (1‚Äì7)</label></div>
      </div>
      <div class="cam-status">Camera: <span id="kpiCam">off</span></div>

      <div class="live-sense">
        <div class="live-head">
          <h3>Live Stress Meter</h3>
          <small>this iteration (webcam-based estimate)</small>
        </div>
        <div class="live-body">
          <div class="cam-box">
            <video id="cam" autoplay muted playsinline></video>
            <div class="cam-note">Optional ‚Ä¢ processed locally ‚Ä¢ no recording</div>
          </div>
          <div class="meter-vert" aria-label="Live worry meter">
            <div class="meter-track">
              <div id="liveMeterFill" class="meter-fill"></div>
            </div>
            <div id="liveMeterVal" class="meter-val">‚Äì</div>
            <div class="meter-label">worry (1‚Äì7)</div>
          </div>
        </div>
      </div>


      <div class="chart">
        <div class="chart-head">
          <h3>Worry Meter</h3>
          <small>across iterations</small>
        </div>
        <canvas id="worryChart" width="380" height="160" aria-label="Worry chart"></canvas>
      </div>

      <div class="panel-section">
        <h3>Session</h3>
        <div id="conditionBox" class="conditions"></div>
        <button id="endSession" class="danger" disabled>Finish & Survey</button>

        <div id="exportBox" class="export-card" style="display:none; margin-top:12px;">
          <h4>Export session data</h4>
          <p class="muted">Available after <b>3 iterations</b>.</p>
          <button id="exportCsv" class="primary">Download CSV</button>
        </div>
      </div>
    </aside>
  </main>

  <div class="modal" id="affectModal" alighn="center" hidden>
    <div class="modal-content">
      <h3>How do you feel after reading these updates?</h3>
      <p>Move the slider toward calm (1) or worried (7), then submit to proceed.</p>
      <div class="slider-row">
        <span>üòå 1</span>
        <input type="range" min="1" max="7" value="4" id="affectSlider"/>
        <span>7 üò∞</span>
      </div>
      <button id="submitAffect" class="primary">Submit</button>
    </div>
  </div>

  <div class="modal" id="surveyModal" hidden>
    <div class="modal-content survey">
      <h3>Quick Survey</h3>
      <div class="q">
        <label>1) Which statement best matches what you saw?</label>
        <div>
          <label><input type="radio" name="q1" value="A"/> Everything sounded final and confirmed.</label>
          <label><input type="radio" name="q1" value="B"/> Some items were marked ‚ÄúDeveloping / may change.‚Äù</label>
          <label><input type="radio" name="q1" value="C"/> Most updates felt like rumors or speculation.</label>
        </div>
      </div>
      <div class="q">
        <label>2) How reliable did you find the updates overall?</label>
        <input type="range" min="1" max="7" value="4" id="trustSlider"/>
      </div>
      <div class="q">
        <label>3) What would you do next? (choose any)</label>
        <div class="grid3">
          <label><input type="checkbox" id="act_dso"/> Contact school DSO</label>
          <br>
          <label><input type="checkbox" id="act_lawyer"/> Consult an immigration lawyer</label>
          <br>
          <label><input type="checkbox" id="act_wait"/> Wait for official confirmation</label>
        </div>
      </div>
      <button id="submitSurvey" class="primary">Submit survey</button>
    </div>
  </div>
<footer class="foot">
    <small>H1B News Lab ‚Äî class prototype ‚Ä¢ All news items are <b>simulated</b> for research.</small>
  </footer>

  <script defer src="https://cdn.jsdelivr.net/npm/face-api.js@0.22.2/dist/face-api.min.js"></script>
  <script src="app.js"></script>
</body>
</html>
